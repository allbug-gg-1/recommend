version: '3.9'

services:
  consul:
    image: hashicorp/consul:1.16.2
    ports:
      - "8500:8500"      # Consul UI 访问端口
      - "8600:8600/udp"  # DNS 查询端口
    command: agent -dev -client=0.0.0.0 -bind=0.0.0.0
    networks:
      - app-network
  gate-service:
    build: ./recommend-gateway
    ports:
      - "8112:8112"  # 将主机的8081端口映射到容器的8080端口
    networks:
      - app-network
    environment:
      - SPRING_PROFILES_ACTIVE=docker
  api-service:
    build: ./recommend-api
    ports:
      - "8111:8111"  # 将主机的8081端口映射到容器的8080端口
    networks:
      - app-network
    environment:
      - SPRING_PROFILES_ACTIVE=docker
networks:
  app-network:
    driver: bridge  # 创建一个私有网络，供服务之间通信
